var MapWizard=function(){function a(a,f,q,h,m){var e={maxBounds:new L.LatLngBounds(L.latLng(84.9999,-179.9999),L.latLng(-84.9999,179.9999)),minZoom:d.minLevel,maxBoundsViscosity:1};$.extend(e,m);a=L.map(a,e);L.tileLayer(f,{attribution:q}).addTo(a);a.on("click",h);return a}var d={minLevel:2,country:3,state:5,city:10,city_up:8},h={mapId:"map",urlTemplate:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\x26copy; \x3ca href\x3d"http://osm.org/copyright"\x3eOpenStreetMap\x3c/a\x3e contributors',
center:[50.4422,30.521698],scale:d.city,onMapClick:function(a){},props:{}},f,m=function(){f||(f=a(h.mapId,h.urlTemplate,h.attribution,h.onMapClick,{}));return f};return{defaultParams:function(){return h},build:function(d){var h=d.center,q=d.scale;f=a(d.mapId,d.urlTemplate,d.attribution,d.onMapClick,d.props);m().setView(h,q);return m()},zoomMode:d}},RouteWizard=function(a){function d(a,b,e){var c=L.marker(a,{icon:"source"===e?n:H,draggable:!1}).addTo(p).on("click",k);0<$.trim(b).length&&c.bindPopup(b);
t[e].push(a)}function h(a){void 0!==p&&0!==a.length&&($.each(a,function(a,b){d(L.latLng(b.lat,b.lon),b.label,b.relation)}),f(a,function(a){return z.city},!1))}function f(a,b,e){var c=a.length;$.each(a,function(a,t){A.reverse(L.latLng(t.lat,t.lon),b(t),function(a){c--;if(void 0!==a&&0<a.length)if(a=a[0],a=a.geocode||a,e&&d(a.center,a.html||a.name,t.relation),"Polygon"===a.properties.geojson.type||"MultiPolygon"===a.properties.geojson.type)L.geoJSON(a.properties.geojson,{style:"source"===t.relation?
J:K}).addTo(p),C[t.relation].push(a.properties.boundingbox),w();else if("Point"===a.properties.geojson.type){var v=z.city_up;b(t)==v&&(v=z.state);f([t],function(a){return v},e)}})})}function m(b,e,c){if(void 0!==p){b=b.concat(e).map(function(a){return L.latLng(a.lat,a.lon)});var d=e=!1;a.option&&(e=a.option.weighting,d="fastest"===e?!1:!0);L.Routing.control({router:L.Routing.graphHopper(void 0,{serviceUrl:a.graphhopperServiceUrl,urlParameters:{weighting:e?e:"fastest",chDisable:d}}),plan:L.Routing.plan(b,
{createMarker:function(a,b){}}),autoRoute:!1}).addTo(p).route({callback:function(a,b){a?(console.error(a),c&&c(!0)):(a=b[0],L.Routing.line(a).addTo(p),c&&c(!1,a.summary.totalDistance,a.summary.totalTime,a.instructions))}});w();return"showRoute"}}function l(a){p&&p.scrollWheelZoom.enable()}function k(a){p.panTo(a.latlng)}function q(a){return $.grep(a,function(a){return a.town||a.address})}function u(a){return $.grep(a,function(a){return!a.town&&!a.address})}function r(a){return $.grep(a,function(a){return 0!==
a.lat&&0!==a.lon})}function e(a){void 0!==p&&0!==a.length&&($.each(a,function(a,b){d(L.latLng(b.lat,b.lon),b.label,b.relation)}),f(a,function(a){return a.country?z.country:z.state},!1))}function b(a,b){$.each(a,function(a,e){e.relation=b})}function c(a){if(void 0!==p){var b=C.source.length||C.target.length,e=b?C:t,c=[];a?Array.prototype.push.apply(c,e[a]):(Array.prototype.push.apply(c,e.source),Array.prototype.push.apply(c,e.target));if(0<c.length){if(b){a=c[0];var d=a[0],w=a[1],v=a[2],f=a[3];1<c.length&&
$.each(c,function(a,b){d=Math.min(d,b[0]);w=Math.max(w,b[1]);v=Math.min(v,b[2]);f=Math.max(f,b[3])});c=L.latLng(d,v);a=L.latLng(w,f)}else{var q=180,h=-180,m=-90,k=90;$.each(c,function(a,b){q=Math.min(q,b.lat);h=Math.max(h,b.lat);k=Math.min(k,b.lng);m=Math.max(m,b.lng)});c=L.latLng(q,m);a=L.latLng(h,k)}p.fitBounds(new L.LatLngBounds(c,a))}}}function w(){clearTimeout(B);B=setTimeout(function(){c()},1E3)}var p,t={source:[],target:[]},C={source:[],target:[]},z={},n=new L.Icon({iconUrl:"/static/common/leaflet/images/marker-icon-blue.svg",
shadowUrl:"/static/common/leaflet/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),H=new L.Icon({iconUrl:"/static/common/leaflet/images/marker-icon-red.svg",shadowUrl:"/static/common/leaflet/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),J={color:"#4386ff",weight:2,opacity:.65},K={color:"#f74850",weight:2,opacity:.65},A=new L.Control.Geocoder.Nominatim({serviceUrl:a.nominatimServiceUrl,geocodingQueryParams:{"accept-language":window.locale,
polygon_geojson:1,limit:1},reverseQueryParams:{"accept-language":window.locale,polygon_geojson:1,namedetails:1,extratags:1}}),B;return{defaultParams:function(){return{mapId:"map"}},build:function(c){var d=c.mapId;c=a.route.waypointListSource;var w=a.route.waypointListTarget,t=a.event||{};b(c,"source");b(w,"target");var f=new MapWizard;z=f.zoomMode;var k=f.defaultParams();k.mapId=d;k.onMapClick=l;k.props={dragging:!0,scrollWheelZoom:!1};p=f.build(k);L.Control.geocoder({geocoder:A}).addTo(p);f=f.defaultParams();
d=f.center;f=f.scale;if(c&&w){var v=r(c.concat(w)),n=q(v),k=u(v);h(n);e(k)}k=!1;n&&n.length===v.length?(k=!0,m(c,w,t.loadRoute)):v&&0===v.length&&void 0!==p&&p.setView(d,f);k||(v=t.loadRoute)&&v(!1,0,0);$(".leaflet-control-geocoder, .leaflet-routing-container").hide()},setViewBoxBySource:function(){c("source")},setViewBoxByTarget:function(){c("target")},setViewBoxByDefault:function(){c()}}},ProposalLiveSearch=function(a){function d(){!document[c]&&$.ajax({url:$.uri("/"+a.options.proposalType+"/live/"+
a.utils.filterUrlCreator(null,!0)),type:"GET",data:{showTimeFrom:k}}).done(function(b){b=$(b).filter(".ps_search-result_data-item");var c=l.find(a.selectors.resultTable.row).length;k=(new Date).getTime();e=b.length;(a.views.counter.counter.innerText=e)?(l.prepend(b),e+c>a.options.perPage&&l.find(a.selectors.resultTable.row+":nth-last-child(-n+"+Math.abs(a.options.perPage-(e+c))+")").remove(),a.utils.rebind(b),a.views.counter.container.style.display="inline"):a.views.counter.container.style.display=
"none"}).fail(function(){a.views.counter.container.style.display="none"})}function h(){1===r?r=10:r--;a.views.timer.timer.innerText=r}function f(){this.checked?(a.views.timer.container.style.display="block",u=setInterval(h,1E3),q=setInterval(d,1E4),m("hidden"),sessionStorage.setItem("live-search","on")):(a.views.timer.container.style.display="none",a.views.counter.container.style.display="none",clearInterval(q),clearInterval(u),r=10,a.views.timer.timer.innerText=r,m("visible"),sessionStorage.setItem("live-search",
"off"))}function m(b){a.selectors.elementsMustBeHidden.forEach(function(a){if(a=document.querySelector(a))a.style.visibility=b})}var l=$(a.selectors.resultTable.container),k=(new Date).getTime(),q=null,u=null,r=10,e=0,b="on"===sessionStorage.getItem("live-search"),c=["mozHidden","msHidden","webkitHidden"].reduce(function(a,b){return"undefined"!==typeof document[b]?b:a},"hidden");$(".ps_action_reset").click(function(){f()});a.views.switcher.container.show();a.views.switcher.switcher.change(f);b&&a.views.switcher.switcher.click()},
ProposalsTransFields=function(a){$("#ps_content_main").removeClass("no-js");$(document).on("focus",".select2.select2-container.select2-container--default",function(a){$(this).find(".select2-search__field")[0].focus()});$("#ps__extended_adr, #ps__extended_from").selectmenu({classes:{"ui-selectmenu-menu":"ps_trans"}});checkboxesSelect({containerId:$("#option_unit_select-container_docs-include"),placeholderMnemo:a.mnemo.docsNeed,staticPlaceholder:!0});checkboxesSelect({containerId:$("#option_unit_select-container_docs-exclude"),
placeholderMnemo:a.mnemo.docsNotNeed,staticPlaceholder:!0});checkboxesSelect({containerId:$("#option_unit_select-container_loads"),placeholderMnemo:a.mnemo.loadType});checkboxesSelect({containerId:$("#option_unit_select-container_trans-type"),placeholderMnemo:a.mnemo.bodyType,customMnemo:!0});(function(){$("#ps_proposals_show-contacts__toggle").change(function(){var d=$(this).is(":checked");$.cookie("showContacts",d,{path:"/",domain:a.model.cookieDomain})})})()},ResultTable=function(a,d,h){function f(a){a.html(h);
a.attr("data-is-in-local","true");a.closest(".ps_search-result_data-item").addClass("isViewed")}function m(a){a.html(d);a.attr("data-is-in-local","false")}function l(e){var b=localStorage.getItem("isViewed"),b=JSON.parse(b),c=0;for(c;c<b[a].length;c++)if(b[a][c].id===e){b[a].splice(c,1);break}localStorage.setItem("isViewed",JSON.stringify(b))}function k(a){a.each(function(){var b=$(this),c=b.attr("data-ignore-text"),e=b.attr("data-unignore-text"),d=b.attr("data-ref-id"),f=(window.IGNORES||[]).some(function(a){return a==
d});b.text(f?e:c);b.unbind("click").click(function(){f?$.ajax({url:"/ajax/user/ignore/"+d,type:"DELETE"}).done(function(){window.IGNORES=(window.IGNORES||[]).filter(function(a){return a!=d});k(a)}):$.ajax({url:"/ajax/user/ignore/",type:"PUT",processData:!1,contentType:"application/json",data:JSON.stringify({ignoreComments:!0,ignoreMessages:!0,ignoreProposals:!0,ignoreRefId:d})}).done(function(){window.IGNORES.push(+d);k(a)})})})}function q(){$(".ps_search-result_data-item .ps_options_list__item__viewed").each(function(){var e=
$(this),b=e.attr("data-ps-id"),c=!1;r[a]&&r[a].length?r[a].forEach(function(a){a.id===b?new Date>new Date(a.timeExpire)?(m(e),l(b)):(f(e),c=!0):c||m(e)}):m(e,b)});$(".ps_options_list__item__viewed").unbind("click").click(function(){var e=$(this),b=e.attr("data-ps-id");if("true"===e.attr("data-is-in-local"))m(e),l(b),e.closest(".ps_search-result_data-item").removeClass("isViewed");else{f(e);var e=localStorage.getItem("isViewed"),e=JSON.parse(e),c=new Date;c.setDate(c.getDate()+14);500<=e[a].length&&
e[a].shift();e[a].push({id:b,timeExpire:c});localStorage.setItem("isViewed",JSON.stringify(e))}$(".ps_options_list").removeClass("active")})}null===localStorage.getItem("isViewed")&&localStorage.setItem("isViewed",JSON.stringify({trans:[],gruz:[]}));var u=localStorage.getItem("isViewed"),r=JSON.parse(u),u=$(".ps_options_list__item__ignore");u.length&&k(u);q();return function(){function e(){A.not($(this).next()).removeClass("active");$(this).next().toggleClass("active")}function b(){$(this).closest(".ps_proposal_user_info").next(".ps_proposal_user_contacts").fadeToggle(150)}
function c(){var a=$(this),b=a.closest(".ps_search-result_data-item");a.is(":checked")?(b.addClass("ps_item__active"),x++,y.push(b.attr("data-ps-id"))):(b.removeClass("ps_item__active"),x--,y.splice(y.indexOf(b.attr("data-ps-id")),1),0===x&&m.prop("checked",!1));t(x)}function d(b){var c=$(b.target);b.stopPropagation();c.hasClass("ps_data-contacts")||c.parents().hasClass("ps_data-contacts")||window.open($.uri("/"+a+"/view/"+$(this).attr("data-ps-id")),"_blank")}function f(a){a?(y=[],$(".ps_search-result_data-item").each(function(){y.push($(this).attr("data-ps-id"));
$(this).addClass("ps_item__active")}),n.prop("checked",!0),x=n.length):(n.prop("checked",!1),$(".ps_search-result_data-item").removeClass("ps_item__active"),y=[],x=0);t(x)}function t(a){var b=$("#ps_actions-modal"),c=$(".ps_actions_count");0<a?b.fadeIn():b.fadeOut();c.text(a)}function h(a){a.showBtn.click(e);a.offerRows.click(d);a.checkboxItems.change(c);a.tooltips.tooltip(I);a.faceTitles.click(b)}var m=$("#ps_ch_select-all"),n=$(".ps_ch_select"),r=$(".ps_data_wrapper"),l=$(".distance-tooltip"),u=
$(".ps_options_btn"),A=$(".ps_options_list"),B=$(".ps_proposal_user_contacts"),E=$("#ps_proposals_show-contacts__toggle"),F=$(".ps_proposal_user_face_title"),G=$(".ps_actions_print"),x=0,y=[];$(document.body).click(function(a){a=$(a.target);a.closest(".ps_options_btn").length||a.closest(".ps_options_list").length||A.removeClass("active")});var I={content:function(){var a=secondsToString($(this).data("time")/1E3),b=$(this).data("distance");if(b)return b="~"+Math.round(b/1E3)+window.localization["proposals.view.kilometer"],
b+" "+a},position:{my:"left+4 center",at:"right center",using:function(a,b){$(this).css(a);$("\x3cdiv\x3e").addClass("ui-tooltip-arrow").addClass(b.vertical).addClass(b.horizontal).appendTo(this)}}};h({showBtn:u,offerRows:r,checkboxItems:n,tooltips:l,faceTitles:F});m.change(function(){f($(this).is(":checked"))});E.change(function(){$(this).is(":checked")?B.fadeIn(150):B.fadeOut(150)});G.click(function(){window.open($.uri("/"+a+"_old/print/?ids\x3d"+y.join(",")),"_blank")});return function(a){a=$(a);
B=$(".ps_proposal_user_contacts");A=$(".ps_options_list");n=$(".ps_ch_select");var b=$(".ps_options_list__item__ignore");b.length&&k(b);q();h({showBtn:a.find(".ps_options_btn"),offerRows:a.find(".ps_data_wrapper"),checkboxItems:a.find(".ps_ch_select"),tooltips:a.find(".distance-tooltip"),faceTitles:a.find(".ps_proposal_user_face_title")})}}()},PageStatistics=function(a){var d=a.page;a=$(".st-page_wrapper");var h=new MapWizard,f=h.build(h.defaultParams()),m=new L.Icon({iconUrl:"/static/common/leaflet/images/marker-icon-blue.svg",
shadowUrl:"/static/common/leaflet/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),l,k="/"+d+"/stats/go/search/";f.locate({setView:!0});"gruz"===d?a.addClass("st-page_wrapper_cargo"):"trans"===d&&a.addClass("st-page_wrapper_trans");$("select").selectmenu({create:function(){var a=$(this).attr("id");$("#"+a+"-menu").css({"max-width":$(this).next().width()+1})}});(function(){var a=$(".st-page_table_toggle"),d=$(".st-page__top-nav"),f=$(".st-page_table"),
e=$(".st-page__top-nav_switch");e.click(function(){$(this).toggleClass("active-nav_switch")});a.click(function(){$(this).toggleClass("active_button-table");f.toggleClass("active-table")});d.click(function(){$(this).toggleClass("st-page__top-nav__active")});$([e,a,f,d]).clickoutside(function(){f.removeClass("active-table");d.removeClass("st-page__top-nav__active");a.removeClass("active_button-table");e.removeClass("active-nav_switch")})})();countryTable({url:"/ajax/proposal/stats/"+d+"/country",callback:function(a){var h=
$(".st-page_table_items"),q=a.reduce(function(a,b){a[b.sign]=b.outgoingLink;return a},{});proposalsMap({url:"/ajax/proposal/stats/counters/"+d+"?bounds\x3dboundsVal\x26mode\x3dmodeVal",callback:function(a){var b=a.mode,c=[];forceRemoveMarkers(f);l&&f.removeLayer(l);l=L.markerClusterGroup({iconCreateFunction:function(a){a=a.getAllChildMarkers();for(var b=0,c=0;c<a.length;c++)b+=a[c].number;return new L.DivIcon({html:"\x3cdiv class\x3d'custom-cluster'\x3e"+b+"\x3c/div\x3e",className:"leaflet-div-icon__custom"})}});
a.counters.map(function(a){var d={id:a.id,name:a.display,sign:a.sign,template:k};if(0!=a.value){var e=L.marker([a.lat,a.lon],{icon:m}),h=window.matchMedia("(min-width: 991px)").matches?"mouseover":"hover";c.push(e);e.bindPopup(a.display+": "+a.value);e.on(h,function(){this.openPopup()});e.on("mouseout",function(){this.closePopup()});window.matchMedia("(min-width: 991px)").matches&&(e.url=function(){return"COUNTRIES"===b?$.uri(q[a.sign]):makeProposalsUrl(d).townFromUrl},e.on("click",function(){window.open(this.url(),
"_blank")}));"TOWNS"===b?e.number=a.value:e.addTo(f)}});"TOWNS"===b&&(l.addLayers(c),f.addLayer(l))},funcMapper:function(a){return{counters:a.counters,mode:a.mode}},map:f});a.map(function(a){a.template=k;h.append(function(){return countryTableMarkUp(a)})})},funcMapper:function(a){return a.countries}});proposalsStat({url:"/ajax/proposal/stats/counter/published",callback:function(a){$(".st-page__top-nav_link-counter__cargo").html(a.gruz);$(".st-page__top-nav_link-counter__trans").html(a.trans)},funcMapper:function(a){$(".st-page_container").removeClass("spinner");
return a.result}});proposalsToday({url:"/ajax/proposal/stats/counter/today/"+d,callback:function(a){$(".st-page_counter-info").html(a)},funcMapper:function(a){return a.result}});proposalsPeriod({url:"/ajax/proposal/stats/counter/periodVal/typeVal?countryFrom\x3dcountryFromVal\x26countryTo\x3dcountryToVal",callback:function(a){$(".st-page_period-counter").html(a.toLocaleString())},funcMapper:function(a){return a.result}})};
function countryTable(a){(new SendRequest).caller($.uri(a.url),a.callback,a.funcMapper)}function proposalsStat(a){(new SendRequest).caller($.uri(a.url),a.callback,a.funcMapper)}function proposalsToday(a){(new SendRequest).caller($.uri(a.url),a.callback,a.funcMapper)}
function proposalsPeriod(a){function d(){var d=a.url,f={countryFromVal:$("[name\x3dcountryFrom]").val(),countryToVal:$("[name\x3dcountryTo]").val(),periodVal:$("[name\x3dperiod]").val(),typeVal:$("[name\x3dtype]").val()},m;for(m in f)d=d.replace(m,f[m]);(new SendRequest).caller($.uri(d),a.callback,a.funcMapper)}d();$(".sp_search_select").on("selectmenuchange",function(){d()})}
function proposalsMap(a){function d(d){var h=a.url;(new SendRequest).caller($.uri(function(){var k=a.map.getBounds();return h=h.replace("typeVal",d).replace("boundsVal",k._northEast.lat+","+k._northEast.lng+";"+k._southWest.lat+","+k._southWest.lng).replace("modeVal",f)}()),a.callback,a.funcMapper)}var h=$("[name\x3dst_sort]"),f="countries";h.attr("checked")&&"countries"===h.attr("data-id")&&a.map.setZoom(4);h.on("change",function(){f=$(this).attr("data-id");"countries"===$(this).attr("data-id")?
a.map.setZoom(4):a.map.setZoom(9)});a.map.on("moveend",function(){d()});d()}function SendRequest(){this.caller=function(d,h,f){a(d,h,f)};var a=function(d,h,f){$.ajax({url:d,type:"GET"}).done(function(m){"READY"!==m.status?setTimeout(function(){a(d,h,f)},1500):h&&h(f(m))})}}
function countryTableMarkUp(a){var d=makeProposalsUrl(a);return"\x3cdiv class\x3d'st-page_table_item'\x3e\x3cdiv class\x3d'st-page_table_item-data st-page_table_item-country'\x3e\x3cspan\x3e"+a.name+"\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'st-page_table_item-data st-page_table_item-from'\x3e\x3ca href\x3d"+d.countryFromUrl+" class\x3d'st-page_table_item-link' target\x3d'_blank'\x3e"+a.outgoing+"\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3d'st-page_table_item-data st-page_table_item-to'\x3e\x3ca href\x3d"+
d.countryToUrl+" class\x3d'st-page_table_item-link' target\x3d'_blank'\x3e"+a.incoming+"\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3d'st-page_table_item-data st-page_table_item-internal'\x3e\x3ca href\x3d"+d.countryInnerUrl+" class\x3d'st-page_table_item-link' target\x3d'_blank'\x3e"+a.inner+"\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e"}
function makeProposalsUrl(a){return{countryFromUrl:$.uri(a.outgoingLink),countryToUrl:$.uri(a.incomingLink),countryInnerUrl:$.uri(a.innerLink),townFromUrl:$.uri(a.template+"town/outgoing?locationId\x3d"+a.id+"\x26locationName\x3d"+a.name)}}function forceRemoveMarkers(a){if(Object.keys(a._targets).length)for(var d in a._targets)a.removeLayer(a._targets[d])}
document.addEventListener("DOMContentLoaded",function(){var a=document.getElementById("carrier-proposal-back");if(a){var d=document.getElementById("carrier"),h=document.getElementById("comment"),f=document.getElementById("submit-offer"),m=document.querySelector(".frame__autocomplete__options"),l=document.getElementById("carrier-proposal-trigger"),k=null,q=[],u={},r=document.getElementById("carrier-error");if(a&&a.dataset)var e=a.dataset.proposal;l&&l.addEventListener("click",function(){a.style.display=
"block"});var b=function(a,b,d){var c;return function(){var e=this,f=arguments,p=d&&!c;clearTimeout(c);c=setTimeout(function(){c=null;d||a.apply(e,f)},b);p&&a.apply(e,f)}}(function(a,b){var c=new XMLHttpRequest;c.open("GET","/ajax/user/search/?excludeCurrent\x3dtrue\x26query\x3d"+a||"",!0);c.onreadystatechange=function(){4===this.readyState&&200===this.status&&b(JSON.parse(c.response))};c.send()},400);d&&d.addEventListener("keyup",function(){r.style.display="none";b(this.value,function(a){a=a.items;
m.innerHTML=a.reduce(function(a,b){b=b.owner;var c='\x3cli class\x3d"frame__autocomplete__option" data-carrier\x3d"'+b.id+'"\x3e\x3cdiv class\x3d"firm__side firm__with-avatar"\x3e\x3cdiv class\x3d"firm__avatar"\x3e\x3cimg src\x3d"'+(b.logoUrls.url40x40?"//"+b.logoUrls.url40x40:"/static/images/logo/nologo40x40.png")+'"/\x3e\x3c/div\x3e\x3cdiv class\x3d"frame__autocomplete__option__column"\x3e\x3cspan class\x3d"firm__name"\x3e'+(b.vip?'\x3cimg src\x3d"/static/images/vip_icon.png" alt\x3d"vip" class\x3d"vip-icon"/\x3e':
"")+"\x3cspan\x3e"+b.nameWithoutBrand+"\x3c/span\x3e\x3c/span\x3e\x3cspan\x3e"+b.timeOnSite+'\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"frame__autocomplete__option__column firm__location"\x3e\x3cspan class\x3d"firm__name"\x3e'+b.address.country+"\x3c/span\x3e\x3cspan\x3e"+b.address.town+'\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"firm__side firm__statistic"\x3e\x3cdiv class\x3d"firm__counters"\x3e\x3ca class\x3d"firm__counter firm__counter_green" target\x3d"_blank" href\x3d"'+$.uri("/reliability_zone/search_responses/?firmToId\x3d"+
b.id+"\x26responseRate\x3dpositive")+'"\x3e'+b.rating.goodRespCount+'\x3c/a\x3e / \x3ca class\x3d"firm__counter firm__counter_red" target\x3d"_blank" href\x3d"'+$.uri("/reliability_zone/search_responses/?firmToId\x3d"+b.id+"\x26responseRate\x3dnegative")+'"\x3e'+b.rating.badRespCount+'\x3c/a\x3e / \x3ca class\x3d"firm__counter" target\x3d"_blank" href\x3d"'+$.uri("/reliability_zone/firm_raiting/"+b.id)+'"\x3e'+b.rating.raitingBal.toFixed(2)+'\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3d"flag flag-'+b.address.countrySign.toLowerCase()+
'"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/li\x3e';u[b.id]=b;return a+c},"");q=document.querySelectorAll(".frame__autocomplete__option");q.forEach(function(a){a&&a.addEventListener("click",function(){k=this.dataset.carrier;f[k?"removeAttribute":"setAttribute"]("disabled","true");m.innerHTML="";d.value=u[k]?u[k].nameWithoutBrand:""})});this.value||(k=null,f.setAttribute("disabled","true"))})});f[k?"removeAttribute":"setAttribute"]("disabled","true");document.body.addEventListener("click",function(b){f[k?"removeAttribute":
"setAttribute"]("disabled","true");if(!m.contains(b.target)){if("carrier-proposal-back"===b.target.id||"frame__close"===b.target.className)d.value="",h.value="",k=null,a.style.display="none",u={};m.innerHTML="";k||(d.value="")}});f&&f.addEventListener("click",function(){k&&(f.setAttribute("disabled","true"),$.ajax({url:"/ajax/proposal/contract/",type:"POST",processData:!1,contentType:"application/json",data:JSON.stringify({proposalId:e,carrierRefId:k,ownerComment:h.value})}).done(function(){window.location.href=
$.uri("/log/mygruztrans/offers/")}).fail(function(){r.style.display="block";f.removeAttribute("disabled")}))})}});
var getPredlRules=function(){return{valueSelector:"i",suffix:".html",params:[{order:1,name:"c",key:"countryIdFrom",type:"intArray"},{order:2,name:"r",key:"regionIdFrom",type:"intArray"},{order:3,name:"a",key:"areaIdFrom",type:"intArray"},{order:4,name:"t",key:"townIdFrom",type:"intUtf8Pairs"},{order:5,name:"h",key:"countryIdTo",type:"intArray"},{order:6,name:"j",key:"regionIdTo",type:"intArray"},{order:7,name:"e",key:"areaIdTo",type:"intArray"},{order:8,name:"f",key:"townIdTo",type:"intUtf8Pairs"},
{order:9,name:"m",key:"massGroup",group:["massFrom","massTo"],type:"floatSequence"},{order:10,name:"v",key:"volumeGroup",group:["volumeFrom","volumeTo"],type:"floatSequence"},{order:11,name:"b",key:"bodyType",type:"intArray"},{order:12,name:"g",key:"bodyTypeGroup",type:"intArray"},{order:13,name:"d",key:"dateGroup",group:["dateFrom","dateTo"],type:"dateSequence"},{order:14,name:"k",key:"dimensionGroup",group:["length","width","height"],type:"floatSequence"},{order:15,name:"w",key:"includeDocGroup",
group:"includeCmr includeTir includeT1 includeEkmt includeMedBook includeCustomControl".split(" "),type:"boolSequence"},{order:16,name:"n",key:"excludeDocGroup",group:"excludeCmr excludeTir excludeT1 excludeEkmt excludeMedBook excludeCustomControl".split(" "),type:"boolSequence"},{order:17,name:"o",key:"adr",type:"int"},{order:18,name:"p",key:"predlOwners",type:"int"},{order:19,name:"s",key:"showOnly",type:"intArray"},{order:20,name:"q",key:"sortByCountryFirst",type:"bool"},{order:21,name:"u",key:"showIgnore",
type:"bool"},{order:22,name:"l",key:"loadTypes",type:"intArray"},{order:23,name:"x",key:"page",type:"int"},{order:24,name:"y",key:"bodyTypeStrict",type:"bool"},{order:25,name:"z",key:"cargo",type:"intUtf8Pairs"},{order:26,name:"rf",key:"radiusFrom",type:"float"},{order:27,name:"rt",key:"radiusTo",type:"float"},{order:28,name:"ls",key:"loadTypesStrict",type:"bool"},{order:29,name:"pf",key:"postCodeFrom",type:"stringArray"},{order:30,name:"pt",key:"postCodeTo",type:"stringArray"},{order:31,name:"sf",
key:"countryStrictFrom",type:"bool"},{order:32,name:"st",key:"countryStrictTo",type:"bool"},{order:33,name:"gp",key:"groupage",type:"bool"},{order:34,name:"ph",key:"photos",type:"bool"},{order:35,name:"pl",key:"paymentFormIds",type:"intArray"},{order:36,name:"xr",key:"excludeRegionIdFrom",type:"intArray"},{order:37,name:"xa",key:"excludeAreaIdFrom",type:"intArray"},{order:38,name:"xt",key:"excludeTownIdFrom",type:"intUtf8Pairs"},{order:39,name:"xj",key:"excludeRegionIdTo",type:"intArray"},{order:40,
name:"xe",key:"excludeAreaIdTo",type:"intArray"},{order:41,name:"xf",key:"excludeTownIdTo",type:"intUtf8Pairs"}]}};
function PredlFilterBuilder(){function a(a){var b=[],D=0;a.forEach(function(a){b[D++]=a.getId();b[D++]=a.getName()});return b}function d(a){for(var b=0,D=0;D<a.length;D++)var c=a.charCodeAt(D),b=b<<5,b=b+(c-65+1);return b-33}var h,f,m,l,k,q,u,r,e,b,c,w,p,t,C,z,n,H,J,K,A,B,E,F,G,x,y,I,v,M,N,Q,R,S,O,P,T,U,V,W,X,Y,Z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,g=this;this.countryIdFrom=function(a){h=a.map(function(a){return d(a)});return g};this.regionIdFrom=function(a){f=a;return g};this.postCodeFrom=function(a){m=
a;return g};this.areaIdFrom=function(a){l=a;return g};this.townIdFrom=function(b){k=a(b);return g};this.radiusFrom=function(a){q=a;return g};this.excludeRegionIdFrom=function(a){ga=a;return g};this.excludeRegionIdTo=function(a){ha=a;return g};this.excludeAreaIdFrom=function(a){ia=a;return g};this.excludeAreaIdTo=function(a){ja=a;return g};this.excludeTownIdFrom=function(b){ka=a(b);return g};this.excludeTownIdTo=function(b){la=a(b);return g};this.radiusTo=function(a){w=a;return g};this.countryStrictFrom=
function(a){p=a;return g};this.countryStrictTo=function(a){t=a;return g};this.countryIdTo=function(a){u=a.map(function(a){return d(a)});return g};this.regionIdTo=function(a){r=a;return g};this.postCodeTo=function(a){e=a;return g};this.areaIdTo=function(a){b=a;return g};this.townIdTo=function(b){c=a(b);return g};this.massFrom=function(a){C=a;return g};this.massTo=function(a){z=a;return g};this.volumeFrom=function(a){n=a;return g};this.volumeTo=function(a){H=a;return g};this.bodyType=function(a){J=
a;return g};this.bodyTypeGroup=function(a){K=a;return g};this.dateFrom=function(a){A=a;return g};this.dateTo=function(a){B=a;return g};this.length=function(a){E=a;return g};this.width=function(a){F=a;return g};this.height=function(a){G=a;return g};this.includeCmr=function(a){x=a;return g};this.includeTir=function(a){y=a;return g};this.includeT1=function(a){I=a;return g};this.includeEkmt=function(a){v=a;return g};this.includeMedBook=function(a){M=a;return g};this.includeCustomControl=function(a){N=
a;return g};this.excludeCmr=function(a){Q=a;return g};this.excludeTir=function(a){R=a;return g};this.excludeT1=function(a){S=a;return g};this.excludeEkmt=function(a){O=a;return g};this.excludeMedBook=function(a){P=a;return g};this.excludeCustomControl=function(a){T=a;return g};this.loadTypes=function(a){U=a;return g};this.adr=function(a){V=a;return g};this.predlOwners=function(a){W=a;return g};this.showOnly=function(a){X=a;return g};this.sortByCountryFirst=function(a){Y=a;return g};this.showIgnore=
function(a){Z=a;return g};this.photos=function(a){ea=a;return g};this.groupage=function(a){fa=a;return g};this.page=function(a){return g};this.bodyTypeStrict=function(a){aa=a;return g};this.loadTypesStrict=function(a){ba=a;return g};this.cargo=function(b){ca=a(b);return g};this.paymentFormIds=function(a){da=a;return g};this.build=function(){return{countryIdFrom:h,regionIdFrom:f,areaIdFrom:l,townIdFrom:k,countryIdTo:u,regionIdTo:r,postCodeTo:e,areaIdTo:b,townIdTo:c,radiusFrom:q,postCodeFrom:m,radiusTo:w,
countryStrictFrom:p,countryStrictTo:t,massFrom:C,massTo:z,volumeFrom:n,volumeTo:H,bodyType:J,bodyTypeGroup:K,dateFrom:A,dateTo:B,length:E,width:F,height:G,includeCmr:x,includeTir:y,includeT1:I,includeEkmt:v,includeMedBook:M,includeCustomControl:N,excludeCmr:Q,excludeTir:R,excludeT1:S,excludeEkmt:O,excludeMedBook:P,excludeCustomControl:T,loadTypes:U,adr:V,predlOwners:W,showOnly:X,sortByCountryFirst:Y,showIgnore:Z,photos:ea,groupage:fa,bodyTypeStrict:aa,loadTypesStrict:ba,cargo:ca,paymentFormIds:da,
excludeRegionIdFrom:ga,excludeRegionIdTo:ha,excludeAreaIdFrom:ia,excludeAreaIdTo:ja,excludeTownIdFrom:ka,excludeTownIdTo:la}};this.Pair=function(a,b){return{getId:function(){return a},getName:function(){return b}}}}
function PredlFilterUrlFactory(a){function d(a){return(a=parseInt(a))?a:""}function h(a){return a?a:""}function f(a){a&&a.lenght&&(a=a.replace(/,/,"."));return(a=parseFloat(a))?Math.floor(100*a):""}function m(a){return!0===a?"1":""}function l(a,c){return"0".repeat(c).substring(0,c-a.length)+a}function k(a){if(a){a=a.split(".");2<a.length&&4===a[2].length&&(a[2]=a[2].substr(2));for(var b=0;b<a.length;b++)1===a[b].length&&(a[b]=l(a[b],2));return a.join("")}return""}function q(a){if(!a)return"";a=a.toString();
for(var b="",d=0;d<a.length;d++)var e=a.charCodeAt(d).toString(),b=b.concat(l(e,5));return b}function u(a,c,d,e){a=a[c];return Array.isArray(a)&&0<a.length?a.map(d).filter(function(a){return""!==a}).join(e):""}function r(a,c,d,e){var b=[],f=!0,h;for(h in c)if(c.hasOwnProperty(h)){var k=d(a[c[h]]);""!==k&&(f=!1);b.push(k)}return f?"":b.join(e)}var e=getPredlRules();this.getUrl=function(a){if(!e)return"";var b=e.valueSelector||",",l=e.suffix||"",p=(e.params||[]).sort(function(a,b){return(a.order||1)-
(b.order||1)}).map(function(c,e){e=c.name;var l=c.group?c.group:c.key;if(!e||!l)return"";c=c.type||"int";var n;switch(c){case "int":n=d(a[l]);break;case "bool":n=m(a[l]);break;case "intArray":n=u(a,l,d,b);break;case "dateSequence":n=r(a,l,k,b);break;case "boolSequence":n=r(a,l,m,b);break;case "floatSequence":n=r(a,l,f,b);break;case "intUtf8Pairs":n=a[l];c=!0;if(Array.isArray(n)&&0<n.length){for(var l=[],p=0;p<n.length;p++){var t=(0===p%2?d:q)(n[p]);l.push(t);""!==t&&(c=!1)}n=c?"":l.join(b)}else n=
"";break;case "stringArray":n=u(a,l,h,b);break;case "float":n=f(a[l]);break;default:console.log("Error type: ",c)}return""===n?"":e.concat(n)}).join("");return p?p.concat(l):""}};